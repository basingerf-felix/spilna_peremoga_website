{% extends "base.html" %}
{% load static i18n %}

{% block title %}{% trans "Наші реалізовані проєкти" %}{% endblock %}



{% block content %}
    <link rel="stylesheet" href="{% static 'css/main/projects.css' %}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">


<section class="pjs-projects">
  <div class="pjs-container">
    <div class="pjs-head">
      <div class="pjs-eyebrow">{% trans "Останні проєкти" %}</div>
      <h2 class="pjs-title">
        {% trans "Наші" %} <span class="accent">{% trans "реалізовані проєкти" %}</span>
      </h2>
    </div>

{#  <nav class="pjs-filter" aria-label="{% trans 'Фільтр підрозділів' %}">#}
{#  <a class="pjs-link" href="{% url 'projects' %}">{% trans 'Усі' %}</a>#}
{#  {% for u in all_units %}#}
{#    <a class="pjs-link"#}
{#       href="{% url 'projects' %}?unit={{ u.slug }}"#}
{#       {% if u.slug in active_units %}aria-current="true"{% endif %}>#}
{#      {{ u.name }}#}
{#    </a>#}
{#  {% endfor %}#}
{#</nav>#}

    {% for p in projects %}
    <article class="pjs-card{% if p.is_reverse %} is-reverse{% endif %}" data-observe>
      <figure class="pjs-media">
        <div class="pjs-swiper swiper" data-autoplay="4500">
          <div class="swiper-wrapper">
            {% for img in p.images.all %}
              <div class="swiper-slide">
                <img src="{{ img.image.url }}"
                     alt="{{ img.alt|default:p.title }}"
                     {% if forloop.first %}loading="eager"{% else %}loading="lazy"{% endif %}>
              </div>
            {% endfor %}
          </div>
          <div class="pjs-pagination swiper-pagination" aria-label="Slider pagination"></div>
          <div class="pjs-prev swiper-button-prev" aria-label="Previous"></div>
          <div class="pjs-next swiper-button-next" aria-label="Next"></div>
        </div>

        <div class="pjs-badges">
          {% for b in p.badges.all %}
            <span class="pjs-badge">{{ b.text }}</span>
          {% endfor %}
        </div>
      </figure>

      <div class="pjs-content">
        <h3 class="pjs-name">{{ p.title }}</h3>
        <p class="pjs-lead">{{ p.description }}</p>

        <ul class="pjs-meta">
          {% if p.goal %}
          <li>
            <span class="pjs-ico"><i class="bi bi-bullseye" aria-hidden="true"></i></span>
            <span><strong>{% trans "Мета" %}:</strong> {{ p.goal }}</span>
          </li>
          {% endif %}

          {% if p.partners %}
          <li>
            <span class="pjs-ico"><i class="bi bi-people-fill" aria-hidden="true"></i></span>
            <span><strong>{% trans "Партнери" %}:</strong> {{ p.partners }}</span>
          </li>
          {% endif %}

          {% if p.results %}
          <li>
            <span class="pjs-ico"><i class="bi bi-stars" aria-hidden="true"></i></span>
            <span><strong>{% trans "Результати" %}:</strong> {{ p.results }}</span>
          </li>
          {% endif %}
        </ul>

        {# при желании можно сделать ссылку на детальную страницу по slug #}
       {% if p.detail %}
  <a href="{% url 'project_detail' slug=p.detail.slug %}" class="pjs-link">
    {% trans "Дізнатися більше" %} &nbsp;<i class="fa-solid fa-arrow-right"></i>
  </a>
{% else %}
  <a href="#" class="pjs-link" aria-disabled="true" style="pointer-events:none;opacity:.6;">
    {% trans "Детально готується" %}
  </a>
{% endif %}
      </div>
    </article>
    {% endfor %}

    <div class="pjs-footer">
      <a href="#" class="pjs-cta">{% trans "Переглянути всі проєкти" %}</a>
    </div>
  </div>
</section>









    <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
  {# убедись, что подключен Swiper JS/CSS в base.html #}
<script>
(function(){
  const onReady = (fn)=>document.readyState!=='loading'?fn():document.addEventListener('DOMContentLoaded',fn);

  function createSwiper(swiperEl){
    const wrap = swiperEl.closest('.pjs-media') || document;
    const delay = parseInt(swiperEl.dataset.autoplay || '0', 10);

    const opts = {
      loop: true,
      speed: 550,
      slidesPerView: 1,
      watchSlidesProgress: true,
      preloadImages: false,
      lazy: { loadOnTransitionStart: false, loadPrevNext: true, loadPrevNextAmount: 1 },
    };

    const nextEl = wrap.querySelector('.pjs-next');
    const prevEl = wrap.querySelector('.pjs-prev');
    const pagEl  = wrap.querySelector('.pjs-pagination');

    if (nextEl && prevEl)  opts.navigation = { nextEl, prevEl };
    if (pagEl)              opts.pagination = { el: pagEl, clickable: true };
    if (delay)              opts.autoplay   = { delay, disableOnInteraction: false, pauseOnMouseEnter: true };

    return new Swiper(swiperEl, opts);
  }

  onReady(function(){
    if (!window.Swiper){ console.error('Swiper не подключен'); return; }

    const instances = new WeakMap();
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(entry=>{
        const el = entry.target;
        let inst = instances.get(el);
        if (entry.isIntersecting){
          if (!inst){ inst = createSwiper(el); instances.set(el, inst); }
          if (inst.params.autoplay) inst.autoplay.start();
        } else {
          if (inst && inst.params.autoplay) inst.autoplay.stop();
        }
      });
    }, { threshold: 0.2, rootMargin: '0px 0px 200px 0px' });

    document.querySelectorAll('.pjs-swiper').forEach(el => io.observe(el));

    document.addEventListener('visibilitychange', () => {
      instances.forEach((inst) => {
        if (!inst || !inst.params.autoplay) return;
        if (document.hidden) inst.autoplay.stop(); else inst.autoplay.start();
      });
    });
  });
})();
</script>


{% endblock %}

