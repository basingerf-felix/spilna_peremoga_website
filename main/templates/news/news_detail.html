{% extends "base.html" %}
{% load i18n %}
{% load static %}

{% block title %}{{ article.seo_title|default:article.title }}{% endblock %}
{% block meta_description %}{{ article.seo_description }}{% endblock %}

{% block extra_head %}
  <link rel="stylesheet" href="{% static 'css/main/news.css' %}">
  {# PhotoSwipe для детального просмотра, как в project_detail #}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@5/dist/photoswipe.css">
{% endblock %}

{% block content %}
<article class="nws-article">
  <div class="nws-container nws-article__wrap">

    <main class="nws-article__main">
      <header class="nws-article__head">
        <h1 class="nws-article__title">{{ article.title }}</h1>
        <time class="nws-article__date" datetime="{{ article.published_at|date:'Y-m-d' }}">
          {{ article.published_at|date:"d.m.Y" }}
        </time>

        {% if article.cover %}
          <figure class="nws-article__cover">
            <img src="{{ article.cover.url }}" alt="{{ article.title }}">
          </figure>
        {% endif %}
      </header>

      {% if article.lead %}
        <p class="nws-article__lead">{{ article.lead|safe }}</p>
      {% endif %}

      <div class="nws-article__body">
        {{ article.body|safe }}
      </div>

      {% if article.display_author %}
        <div class="nws-article__author">
          <span class="nws-author__label">{% trans "Автор:" %}</span>
          <span class="nws-author__name">{{ article.display_author }}</span>
        </div>
      {% endif %}

      {# Видео (оставил как было) #}
      {% if article.video_file or article.video_url %}
        <section class="nws-video">
          {% if article.video_file %}
            <video class="nws-video__player"
                   {% if article.video_poster %}poster="{{ article.video_poster.url }}"{% endif %}
                   controls playsinline preload="metadata">
              <source src="{{ article.video_file.url }}">
              {% trans "Ваш браузер не підтримує відтворення відео." %}
            </video>
          {% else %}
            <div class="nws-video__embed">
              <iframe src="{{ article.video_url }}"
                      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                      allowfullscreen loading="lazy"></iframe>
            </div>
          {% endif %}
        </section>
      {% endif %}

      {# Галерея с PhotoSwipe, как в project_detail #}
      {% with imgs=article.images.all %}
      {% if imgs %}
        <section class="nws-gallery">
          <h2 class="nws-gallery__title">{% trans "Фотогалерея" %}</h2>

          <div class="nws-gallery__grid" aria-label="{% trans 'Галерея фото новини' %}">
            {% for img in imgs %}
              <a
                class="nws-gallery__item"
                href="{{ img.image.url }}"
                data-pswp-width="{{ img.image.width|default:'1600' }}"
                data-pswp-height="{{ img.image.height|default:'900' }}"
                target="_blank" rel="noreferrer"
              >
                <img src="{{ img.image.url }}" alt="{{ img.alt }}">
              </a>
            {% endfor %}
          </div>
        </section>
      {% endif %}
      {% endwith %}
    </main>

    <aside class="nws-article__aside">
      <div class="nws-aside">
        <h3 class="nws-aside__title">{% trans "Також подивіться:" %}</h3>
        <ul class="nws-aside__list">
          {% for item in also_see %}
            <li class="nws-aside__item">
              <a class="nws-aside__link" href="{% url 'detail' slug=item.slug %}">
                <div class="nws-aside__meta">
                  <div class="nws-aside__name">{{ item.title }}</div>
                  <time class="nws-aside__date" datetime="{{ item.published_at|date:'Y-m-d' }}">
                    {{ item.published_at|date:"d.m.Y" }}
                  </time>
                </div>
                {% if item.cover %}
                  <div class="nws-aside__thumb">
                    <img src="{{ item.cover.url }}" alt="{{ item.title }}">
                  </div>
                {% else %}
                  <div class="nws-aside__thumb nws-aside__thumb--ph" aria-hidden="true"></div>
                {% endif %}
              </a>
            </li>
          {% endfor %}
        </ul>
      </div>
    </aside>

  </div>
</article>

{# PhotoSwipe JS (как в project_detail) #}
<script type="module">
  import PhotoSwipeLightbox from 'https://cdn.jsdelivr.net/npm/photoswipe@5/dist/photoswipe-lightbox.esm.min.js';
  const lightbox = new PhotoSwipeLightbox({
    gallery: '.nws-gallery__grid',
    children: 'a',
    pswpModule: () => import('https://cdn.jsdelivr.net/npm/photoswipe@5/dist/photoswipe.esm.min.js'),
  });
  lightbox.init();
</script>
{% endblock %}
